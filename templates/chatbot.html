

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teacher's Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

     <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.12.313/pdf.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

    <link rel="stylesheet" href="/static/css/chatbot.css">
</head>
<body>
    <div class="sidebar" id="sidebar">
        <h2 class="text-center mb-4">Teacher's Dashboard</h2>
        <!-- Display Logged-In User -->
<div class="user-info d-flex align-items-center mb-3">
    <img id="logged-user-img" src="/static/images/default-user.png" alt="Profile" class="user-avatar rounded-circle me-2" width="40" height="40">
    <span id="user-name">Logged in as: <strong id="logged-user">Guest</strong></span>
</div>


        <a href="#" onclick="loadContent('dashboard')" class="active">Dashboard</a>
       <!--  <a href="#" onclick="loadContent('planner')">Planner</a>
        <a href="#" onclick="loadContent('worksheets')">Worksheets</a>
        <a href="#" onclick="loadContent('flashcards')">Flashcards</a>
        <a href="#" onclick="loadContent('stories')">Stories</a>
        <a href="#" onclick="loadContent('announcements')">Announcements</a> -->
        <a href="#reports" onclick="loadContent('reports')">Reports</a>
        
     

<!-- Sidebar Link -->
<a href="javascript:void(0);" onclick="toggleCommunity()">Community</a>

<!-- Community Submenu (Toggles Open) -->
<div id="community-container" style="display: none;">
    <ul>
    <a href="#chat" onclick="loadContent('chat')">Chat</a>
    <a href="#qna" onclick="loadContent('qna')">Q&A</a>
    <a href="#askE;" onclick="loadContent('askE')">Ask the Expert</a>
</ul>
</div>

        <a href="#settings" onclick="loadContent('settings')">Settings</a>
        <a href="/logout" class="nav-link">Logout</a></li>
        
    
    </div>
    <span class="menu-toggle" onclick="toggleSidebar()">&#9776;</span>
    <div class="content" id="main-content">
        

<!-- Dashboard Section -->
<div id="dashboard" class="content-page">
    <h3>Welcome to the Teacher's Dashboard</h3>
    <div class="row g-4">
        <div class="col-md-4 col-sm-6">
            <div class="card text-center p-3">
                <div class="card-body">
                    <i class="fas fa-file-alt fa-3x mb-3 text-primary"></i>
                    <h5 class="card-title">Worksheets Used</h5>
                    <p class="card-text">3/10</p>
                    <!-- Generate Worksheet Button -->
                    <button class="btn btn-primary" onclick="loadContent('worksheets')">Generate Worksheet</button>
                </div>
            </div>
        </div>
        <div class="col-md-4 col-sm-6">
            <div class="card text-center p-3" onclick="logActivity('Upcoming Events')">
                <div class="card-body">
                    <i class="fas fa-calendar-alt fa-3x mb-3 text-success"></i>
                    <h5 class="card-title">Upcoming Events</h5>
                    <p class="card-text">February 12 2025</p>
                    <!-- Generate Worksheet Button -->
                    <button class="btn btn-success" onclick="loadContent('announcements')">View Calender</button>
                </div>
            </div>
        </div>
        <div class="col-md-4 col-sm-6">
            <div class="card text-center p-3" onclick="logActivity('Flashcards Used')">
                <div class="card-body">
                    <i class="fas fa-book fa-3x mb-3 text-danger"></i>
                    <h5 class="card-title">Flashcards Used</h5>
                    <p class="card-text">5/10</p>
                    <!-- Generate Worksheet Button -->
                    <button class="btn btn-danger" onclick="loadContent('flashcards')">Generate Flashcard</button>
                </div>
            </div>
        </div>
    </div>
<br>
    <!-- Recent Activity Section -->
    <h3>Recent Activity</h3>
    <table class="table">
        <thead>
            <tr>
                <th>User</th>
                <th>Action</th>
                <th>Worksheet</th>
                <th>Date</th>
                <th>Source</th>
                <th>PDF</th>
            </tr>
        </thead>
        <tbody id="pdf-log-body"></tbody>
    </table>

    <!-- Modal for PDF Preview -->
    <div class="modal fade" id="pdfModal" tabindex="-1" aria-labelledby="pdfModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="pdfModalLabel">PDF Preview</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <iframe id="pdfIframe" width="100%" height="100%" style="border: none;"></iframe>
                </div>
            </div>
        </div>
    </div>

    <div id="pagination-controls" class="mt-3"></div>
</div>


<!-- Reports Section -->
<div id="reports" class="content-page" style="display:none;">
    <h1 class="text-center">üìä Reports & Analytics</h1>

    <!-- Download Statistics (Cards Left, Chart Right) -->
    <div class="report-card download-stats">
        <div class="left-content">
            <h3>üì• Download Statistics</h3>
            <div class="stat-box">
                <h5>Worksheets Downloaded</h5>
                <p><span id="worksheets-downloaded">{{total_worksheets}}</span></p>
            </div>
            <div class="stat-box">
                <h5>Flashcards Downloaded</h5>
                <p><span id="flashcards-downloaded">{{total_flashcards}}</span></p>
            </div>
            <div class="stat-box">
                <h5>Most Downloaded Resource</h5>
                <p><span id="most-downloaded">-</span></p>
            </div>
        </div>
        <div class="right-content">
            <canvas id="resource-downloads-chart"></canvas>
        </div>
    </div>

    <!-- User Engagement (Stacked) -->
    <div class="report-card">
        <h3>üë• User Engagement</h3>
        <div class="stat-box">
            <h5>Messages in Community Chat</h5>
            <p><span id="messages-sent">0</span></p>
        </div>
        <div class="stat-box">
            <h5>Forum Posts</h5>
            <p><span id="forum-posts">0</span></p>
        </div>
        <div class="stat-box">
            <h5>Q&A Contributions</h5>
            <p><span id="qa-questions">0</span></p>
        </div>
        <div class="chart-container">
            <canvas id="engagement-chart"></canvas>
        </div>
    </div>

    <!-- Activity Log (Stacked) -->
    <div class="report-card">
        <h3>üìú Activity Log</h3>
        <table class="table">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Action</th>
                    <th>Resource</th>
                    <th>Type</th>
                </tr>
            </thead>
            <tbody id="activity-log-body"></tbody>
        </table>
    </div>

    <!-- Personalized Recommendations (Stacked) -->
    <div class="report-card">
        <h3>üéØ Recommended for You</h3>
        <div class="recommendation-list">
            <div class="recommendation-card">Phonics Blends Worksheet</div>
            <div class="recommendation-card">CVC Words Practice</div>
            <div class="recommendation-card">Vowel Teams Worksheet</div>
        </div>
        <div class="create-worksheet">
            <a href="/chatbot" class="create-worksheet-btn">+ Create More Worksheets and Flashcards</a>
        </div>
    </div>
</div>


        <!-- Planner Section -->
        <div id="settings" class="content-page" style="display:none;">
            <h3>Settings</h3>
        
            <!-- Profile Management -->
            <section class="settings-section">
                <h4>Profile Management</h4>
                <label>Name: <input type="text" id="teacher-name" disabled /></label>
                <label>Email: <input type="email" id="teacher-email" disabled /></label>
                <label>Profile Picture:</label>
                <div class="profile-pic-container">
                    <img id="profile-pic-preview" src="" alt="Profile Picture" />
                </div>
               <!--    <label>New Password: <input type="password" id="new-password" /></label>
                <button onclick="saveProfile()">Save Changes</button>-->
            </section>
        
            <!-- Subscription & Billing -->
            <section class="settings-section">
                <h4>Subscription & Billing</h4>
                <p>Current Plan: <span id="current-plan">Free</span></p>
                <button onclick="subscribe('Monthly', 10)">Subscribe</button>
                
            </section>
        
            <!-- Account Management -->
            <section class="settings-section">
                <h4>Account Management</h4>
                <button onclick="logout()">Log Out</button>
                <button class="delete-btn" onclick="confirmDeleteAccount()">Delete Account</button>
            </section>
        </div>
        
        <script>
            async function loadUserProfile() {
                try {
                    let response = await fetch('/get_user_profile');
                    let data = await response.json();
                    
                    if (data.error) throw new Error(data.error);
                    
                    document.getElementById('teacher-name').value = data.name;
                    document.getElementById('teacher-email').value = data.email;
                    document.getElementById('profile-pic-preview').src = data.picture || "/static/images/default-user.png";
                } catch (error) {
                    console.error("Error loading user profile:", error);
                }
            }
        
            async function saveProfile() {
                try {
                    let password = document.getElementById('new-password').value;
        
                    let response = await fetch('/update_profile', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ password })
                    });
        
                    let result = await response.json();
                    if (result.success) alert("Profile updated successfully!");
                    else throw new Error(result.error);
                } catch (error) {
                    console.error("Error updating profile:", error);
                }
            }
        
            async function subscribe(plan, amount) {
    // Redirect to backend route with plan details
    window.location.href = `/pay?plan=${plan}&amount=${amount}`;
}
        
function confirmDeleteAccount() {
    if (confirm("Are you sure you want to delete your account? This action cannot be undone.")) {
        deleteAccount();
    }
}

async function deleteAccount() {
    try {
        let response = await fetch('/delete_account', { method: 'POST' });
        let result = await response.json();

        if (result.success) {
            alert("Your account has been deleted."); // Show popup message
            window.location.href = "/login"; // Redirect to login page
        } else {
            throw new Error(result.error);
        }
    } catch (error) {
        console.error("Error deleting account:", error);
    }
}

        
            async function logout() {
                window.location.href = "/logout";
            }
        
            // Load user profile on page load
            document.addEventListener("DOMContentLoaded", loadUserProfile);
        </script>
        


 <!-- Chat Section -->
<div id="chat" class="content-page" style="display:none;">
    <h3 class="section-title">Community Chat - Phonics Practice</h3>
           <!-- Display Logged-In User -->
<div class="user-info d-flex align-items-center mb-3">
    <img id="logged-user-img" src="/static/images/default-user.png" alt="Profile" class="user-avatar rounded-circle me-2" width="40" height="40">
    <span id="user-name">Logged in as: <strong id="logged-user">Guest</strong></span>
</div>

    <!-- Chat Room Tabs -->
    <div class="chat-tabs">
        <button class="tab-btn active" onclick="switchRoom('letter-sounds')">Letter Sounds</button>
        <button class="tab-btn" onclick="switchRoom('blending')">Blending</button>
        <button class="tab-btn" onclick="switchRoom('tricky-words')">Tricky Words</button>
        <button class="tab-btn" onclick="switchRoom('sentence-practice')">Sentence Practice</button>
    </div>

    <!-- Chat Box -->
    <div id="chat-box" class="chat-box"></div>

    <!-- Chat Input -->
    <div class="chat-input-container">
        <input type="text" id="chat-input" placeholder="Type a message..." onkeypress="handleKeyPress(event)">
        <button onclick="sendMessage()">Send</button>
    </div>
</div>

<script>
    let userName = "Guest"; // Replace this with actual logged-in username
    let currentRoom = "letter-sounds"; // Default chat room

    // Store messages per room
    let chatRooms = {
        "letter-sounds": [],
        "blending": [],
        "tricky-words": [],
        "sentence-practice": []
    };

    function switchRoom(room) {
        currentRoom = room;
        document.querySelectorAll(".tab-btn").forEach(btn => btn.classList.remove("active"));
        document.querySelector(`[onclick="switchRoom('${room}')"]`).classList.add("active");
        loadChatMessages();
    }

    function sendMessage() {
        let inputField = document.getElementById("chat-input");
        let message = inputField.value.trim();
        if (message === "") return;

        chatRooms[currentRoom].push({ sender: userName, text: message });
        displayMessage(userName, message);
        inputField.value = ""; // Clear input field
    }

    function displayMessage(sender, message) {
        let chatBox = document.getElementById("chat-box");
        let messageDiv = document.createElement("div");
        messageDiv.classList.add("message");
        
        if (sender === userName) {
            messageDiv.classList.add("user-message");
        } else {
            messageDiv.classList.add("other-message");
        }

        messageDiv.innerHTML = `<strong>${sender}:</strong> ${message}`;
        chatBox.appendChild(messageDiv);
        chatBox.scrollTop = chatBox.scrollHeight; // Auto-scroll
    }

    function loadChatMessages() {
        let chatBox = document.getElementById("chat-box");
        chatBox.innerHTML = "";
        chatRooms[currentRoom].forEach(msg => displayMessage(msg.sender, msg.text));
    }

    function handleKeyPress(event) {
        if (event.key === "Enter") {
            sendMessage();
        }
    }

    // Simulated chat messages
    setTimeout(() => chatRooms["letter-sounds"].push({ sender: "JohnDoe", text: "Let's practice letter sounds!" }), 2000);
    setTimeout(() => chatRooms["blending"].push({ sender: "Alice", text: "How do you blend 'sh' and 'ee'?" }), 4000);
</script>




  <!-- Planner Section -->
  <div id="qna" class="content-page" style="display:none;">
    <h3 class="section-title">Q&A - Phonics Challenges</h3>
           <!-- Display Logged-In User -->
<div class="user-info d-flex align-items-center mb-3">
    <img id="logged-user-img" src="/static/images/default-user.png" alt="Profile" class="user-avatar rounded-circle me-2" width="40" height="40">
    <span id="user-name">Logged in as: <strong id="logged-user">Guest</strong></span>
</div>

    <div class="qa-input-container">
        <input type="text" id="qa-question" placeholder="Ask a question...">
        <button onclick="addQuestion()">Ask</button>
    </div>

    <ul id="qa-list" class="qa-list"></ul>
</div>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        fetchQuestions();
        fetchUserProfile();
    });
    
   // Fetch and update logged-in user info
async function fetchUserProfile() {
    try {
        let response = await fetch('/get_user_profile');
        let data = await response.json();

        if (data.error) throw new Error(data.error);

        // Update user details everywhere
        document.querySelectorAll("#logged-user").forEach(el => el.innerText = data.name);
        document.querySelectorAll("#user-name").forEach(el => el.innerHTML = `Logged in as: <strong>${data.name}</strong>`);
        document.querySelectorAll("#logged-user-img").forEach(el => el.src = data.picture || "/static/images/default-user.png");

        // DEBUGGING - Ensure elements are selected
        console.log("User Info Updated:", data.name);
    } catch (error) {
        console.error("Error loading user profile:", error);
    }
}
    
    function fetchQuestions() {
        fetch("/questions")
            .then(response => response.json())
            .then(data => {
                const qaList = document.getElementById("qa-list");
                qaList.innerHTML = "";
                data.forEach(q => {
                    let questionItem = document.createElement("li");
                    questionItem.classList.add("question-item");
                    
                    questionItem.innerHTML = `
                        <div class="question-header">
                            <img src="${q.user_picture}" alt="Profile" class="user-avatar">
                            <span class="question-user">${q.user}</span>
                            <span class="question-time">${q.created_at}</span>
                        </div>
                        <p class="question-text">${q.text}</p>
                        <ul id="answers-${q.id}" class="answers-list"></ul>
                        <div class="answer-input-container">
                            <input type="text" id="answer-${q.id}" placeholder="Write an answer...">
                            <button onclick="addAnswer(${q.id})">Reply</button>
                        </div>
                    `;
                    
                    q.answers.forEach(a => {
                        let answerItem = document.createElement("li");
                        answerItem.classList.add("answer-item");
                        answerItem.innerHTML = `
                            <div class="answer-header">
                                <img src="${a.user_picture}" alt="Profile" class="user-avatar">
                                <span class="answer-user">${a.user}</span>
                                <span class="answer-time">${a.created_at}</span>
                            </div>
                            <p class="answer-text">${a.text}</p>
                        `;
                        questionItem.querySelector(`#answers-${q.id}`).appendChild(answerItem);
                    });
    
                    qaList.appendChild(questionItem);
                });
            });
    }
    
    function addQuestion() {
        const questionInput = document.getElementById("qa-question");
        const questionText = questionInput.value.trim();
        
        if (questionText === "") {
            alert("Please enter a question.");
            return;
        }
    
        fetch("/ask_question", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ question: questionText })
        })
        .then(response => response.json())
        .then(data => {
            if (data.message) {
                questionInput.value = "";
                fetchQuestions();
            } else {
                alert("Error posting question.");
            }
        });
    }
    
    function addAnswer(questionId) {
        const answerInput = document.getElementById(`answer-${questionId}`);
        const answerText = answerInput.value.trim();
    
        if (answerText === "") {
            alert("Please enter an answer.");
            return;
        }
    
        fetch("/answer_question", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ question_id: questionId, answer: answerText })
        })
        .then(response => response.json())
        .then(data => {
            if (data.message) {
                answerInput.value = "";
                fetchQuestions();
            } else {
                alert("Error posting answer.");
            }
        });
    }
    </script>
    


  <!-- Planner Section -->
  <div id="askE" class="content-page" style="display:none;">
    <h3 class="section-title">Ask an Expert - Phonics Inquiry</h3>
           <!-- Display Logged-In User -->
<div class="user-info d-flex align-items-center mb-3">
    <img id="logged-user-img" src="/static/images/default-user.png" alt="Profile" class="user-avatar rounded-circle me-2" width="40" height="40">
    <span id="user-name">Logged in as: <strong id="logged-user">Guest</strong></span>
</div>
    <textarea id="expert-question" placeholder="Write your question..."></textarea>
    <button onclick="submitExpertQuestion()">Submit</button>
</div>


   <!-- Worksheets Section Container -->
<div id="worksheets" class="content-page" style="display:none;">
    <div class="container my-5">
        <div class="shadow p-4 rounded bg-white">
            <h3>Worksheets Section</h3>

            <!-- Topic Selection Buttons -->
            <div class="mb-3">
                <h5>Select a Topic:</h5>
                <div id="topic-buttons" class="btn-group-horizontal" role="group">
                    <button type="button" class="btn btn-primary mb-2" data-value="Synthetic Phonics">Synthetic Phonics</button>
                    <button type="button" class="btn btn-primary mb-2" data-value="Systematic Synthetic Approach">Systematic Synthetic Approach</button>
                    <button type="button" class="btn btn-primary mb-2" data-value="Fundamental Phonics Rules">Fundamental Phonics Rules</button>
                    <button type="button" class="btn btn-primary mb-2" data-value="5 Major Principles Of Phonics">5 Major Principles Of Phonics</button>
                    <button type="button" class="btn btn-primary mb-2" data-value="Jolly Phonics Methodology">Jolly Phonics Methodology</button>
                    <button type="button" class="btn btn-primary mb-2" data-value="42 Sounds With Actions">42 Sounds With Actions</button>
                    <!-- Hidden extra options -->
                    <div id="extra-topics" style="display:none;">
                        <button type="button" class="btn btn-primary mb-2" data-value="Blending & Segmenting">Blending & Segmenting</button>
                        <button type="button" class="btn btn-primary mb-2" data-value="Tricky Words">Tricky Words</button>
                        <button type="button" class="btn btn-primary mb-2" data-value="Alternatives">Alternatives</button>
                        <button type="button" class="btn btn-primary mb-2" data-value="Diagraphs & Trigraphs">Diagraphs & Trigraphs</button>
                        <button type="button" class="btn btn-primary mb-2" data-value="Sight Words">Sight Words</button>
                        <button type="button" class="btn btn-primary mb-2" data-value="Rhyming Words">Rhyming Words</button>
                        <button type="button" class="btn btn-primary mb-2" data-value="Long & Short Vowel">Long & Short Vowel</button>
                        <button type="button" class="btn btn-primary mb-2" data-value="Learning Phonograms">Learning Phonograms</button>
                        <button type="button" class="btn btn-primary mb-2" data-value="Stories & Actions">Stories & Actions</button>
                    </div>
                    <button type="button" class="btn btn-link" id="show-more-topics">+ More</button>
                </div>
            </div>

            <!-- Age Group Selection Buttons -->
            <div class="mb-3">
                <h5>Select Age Group:</h5>
                <div id="age-buttons" class="btn-group-horizontal" role="group">
                    <button type="button" class="btn btn-secondary mb-2" data-value="2-4">2-4 Years</button>
                    <button type="button" class="btn btn-secondary mb-2" data-value="4-5">4-5 Years</button>
                    <button type="button" class="btn btn-secondary mb-2" data-value="5-10">5-10 Years</button>
                    <!-- Hidden extra options -->
                    <div id="extra-age-groups" style="display:none;">
                        <button type="button" class="btn btn-secondary mb-2" data-value="6-8">6-8 Years</button>
                        <button type="button" class="btn btn-secondary mb-2" data-value="9-12">9-12 Years</button>
                    </div>
                    <button type="button" class="btn btn-link" id="show-more-age-groups">+ More</button>
                </div>
            </div>

            <button class="btn btn-success" onclick="generateWorksheet()">Generate AI Worksheet</button>
            <div id="worksheet-display" class="mt-4"></div> <!-- Display selected worksheet here -->
         <!-- Add a container for displaying the PDF with scrolling -->
<div id="pdf-viewer-container" style="width: 100%; height: 500px; overflow: auto; display: none;">
    <canvas id="pdf-canvas"></canvas>
</div>

        </div>
    </div>
</div>


      <!-- Flashcards Section -->
<div id="flashcards" class="content-page" style="display:none;">
    <h3>Flashcards Section</h3>
    
    <!-- Topic Selection Dropdown -->
    <div class="mb-3">
        <h5>Select a Topic:</h5>
        <select id="topic-dropdown1" class="form-control">
            <option value="">Select a Topic</option>
            <option value="Synthetic Phonics">Synthetic Phonics</option>
            <option value="Systematic Synthetic Approach">Systematic Synthetic Approach</option>
            <option value="Fundamental Phonics Rules">Fundamental Phonics Rules</option>
            <option value="5 Major Principles Of Phonics">5 Major Principles Of Phonics</option>
            <option value="Jolly Phonics Methodology">Jolly Phonics Methodology</option>
            <option value="42 Sounds With Actions">42 Sounds With Actions</option>
            <option value="Blending & Segmenting">Blending & Segmenting</option>
            <option value="Tricky Words">Tricky Words</option>
            <option value="Alternatives">Alternatives</option>
            <option value="Diagraphs & Trigraphs">Diagraphs & Trigraphs</option>
            <option value="Sight Words">Sight Words</option>
            <option value="Rhyming Words">Rhyming Words</option>
            <option value="Long & Short Vowel">Long & Short Vowel</option>
            <option value="Learning Phonograms">Learning Phonograms</option>
            <option value="Stories & Actions">Stories & Actions</option>
        </select>
    </div>

    <!-- Age Group Selection -->
    <div class="mb-3">
        <h5>Select Age Group:</h5>
        <select id="age-dropdown1" class="form-control">
            <option value="">Select an Age Group</option>
            <option value="2-4">2-4 Years</option>
            <option value="4-5">4-5 Years</option>
            <option value="5-10">5-10 Years</option>
        </select>
    </div>

    <!-- Start Flashcards Button -->
    <div class="mb-3">
        <button class="btn btn-primary" onclick="generateFlashcards()">Generate AI Flashcards</button>
    </div>


    <div id="flashcards-display" class="d-flex flex-wrap justify-content-center mt-4"></div>



<!-- Download Flashcards Button (Hidden Initially) -->
<button id="downloadFlashcardBtn" class="btn btn-success mt-3" style="display: none;">Download Flashcards PDF</button>


    <!-- Flashcard Container -->
    <div id="flashcard-container" class="d-flex justify-content-center mt-4">
        <div id="loading-popup" class="popup" style="display:none;">
            <div class="popup-content">
                <h3 id="loading-message">Loading...</h3>
            </div>
        </div>
        
    </div>
</div>





        <!-- Stories Section -->
        <div id="stories" class="content-page" style="display:none;">
            <h3>Stories Section</h3>
            <p>Details about stories go here...</p>
        </div>

         <!-- Announcements Section -->
    <div id="announcements" class="content-page" style="display:block;">
        <h3>Upcoming Events</h3>
        <div id="calendar" class="calendar-container">
            <div class="calendar-header">
                <button id="prev-month" onclick="changeMonth(-1)" class="btn btn-outline-primary">&#8592; Previous</button>
                <h3 id="calendar-month-year"></h3>
                <button id="next-month" onclick="changeMonth(1)" class="btn btn-outline-primary">Next &#8594;</button>
            </div>
            
            <!-- Weekdays Row -->
            <div class="weekdays">
                <div>Sun</div>
                <div>Mon</div>
                <div>Tue</div>
                <div>Wed</div>
                <div>Thu</div>
                <div>Fri</div>
                <div>Sat</div>
            </div>

            <!-- Calendar Grid -->
            <div id="calendar-grid"></div>
        </div>
    </div>

    <!-- Event Pop-up -->
    <div id="event-popup" class="popup" style="display:none;">
        <div class="popup-content">
            <h3 id="event-title"></h3>
            <p><strong>Date & Time:</strong> <span id="event-date-time"></span></p>
            <p><strong>Link:</strong> <a href="" id="event-link" target="_blank" class="btn btn-info">Event Details</a></p>
            <p><strong>Payment:</strong> <span id="event-payment"></span></p>
            <button onclick="closePopup()" class="btn btn-danger">Close</button>
        </div>
    </div>

    

    <!-- Bootstrap JS (optional, for pop-up functionality) -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js"></script>
  </div>

    <script>
        function loadContent(sectionId) {
            const sections = document.querySelectorAll('.content-page');
            sections.forEach(section => {
                section.style.display = 'none';
            });

            const activeSection = document.getElementById(sectionId);
            if (activeSection) {
                activeSection.style.display = 'block';
            }

            // Update active link in sidebar
            document.querySelectorAll('.sidebar a').forEach(link => link.classList.remove('active'));
            event.target.classList.add('active');
        }

        // Default content
        document.addEventListener('DOMContentLoaded', () => {
            loadContent('dashboard');
        });

        function toggleSidebar() {
            document.getElementById("sidebar").classList.toggle("show");
        }


        async function fetchAIResponse(prompt) {
    showLoadingPopup("Finishing Touches.....")

    try {
        const response = await fetch("https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=AIzaSyA5ZvilV3z8XOj0FShLEh8vgNq5SNCzgsE", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                contents: [{ parts: [{ text: prompt }] }]
            })
        });

        const data = await response.json();
        console.log("üîç Full API Response:", data);

        hideLoadingPopup();

        // Ensure the response has expected structure
        if (!data.candidates || data.candidates.length === 0 || !data.candidates[0].content.parts[0].text) {
            alert("Error: AI response is missing expected content.");
            return null;
        }

        // Extract AI response and sanitize JSON
        let aiResponse = data.candidates[0].content.parts[0].text.trim();

        // Remove markdown code block indicators (if present)
        aiResponse = aiResponse.replace(/```json/g, "").replace(/```/g, "").trim();

        console.log("‚úÖ AI Message (Cleaned JSON):", aiResponse);

        return JSON.parse(aiResponse); // Now parse safely
    } catch (error) {
        hideLoadingPopup();
        console.error("‚ùå Gemini API Error:", error);
        alert("Failed to connect to AI. Check your API key or response format.");
        return null;
    }
}


 // Function to display worksheet and show download button
 function displayWorksheet(questions, topic, ageGroup) {
        const container = document.getElementById("worksheet-display");

        setTimeout(() => {
            if (typeof questions === "string") {
                try {
                    questions = JSON.parse(questions); // Convert string to JSON if needed
                } catch (error) {
                    console.error("‚ùå Failed to parse AI response as JSON:", error);
                    alert("Invalid worksheet data received.");
                    container.innerHTML = ""; // Remove loading message
                    return;
                }
            }

            if (!questions || !Array.isArray(questions.data)) {
                console.error("‚ùå AI response format is incorrect:", questions);
                alert("Error: AI response format is incorrect.");
                container.innerHTML = ""; // Remove loading message
                return;
            }

            // Remove loading message
            container.innerHTML = "";

            // Create and display the download button
            const downloadBtn = document.createElement("button");
            downloadBtn.className = "btn btn-primary mt-2";
            downloadBtn.innerText = `Download Worksheet: ${topic} (${ageGroup} Years)`;
            downloadBtn.onclick = function () {
                downloadWorksheetPDF(questions.data, topic, ageGroup);
            };

            // Create and display the view button
            const viewBtn = document.createElement("button");
            viewBtn.className = "btn btn-secondary mt-2 ms-3";
            viewBtn.innerText = `View Worksheet: ${topic} (${ageGroup} Years)`;
            viewBtn.onclick = function () {
                toggleViewWorksheetPDF(questions.data, topic, ageGroup);
            };

            container.appendChild(downloadBtn);
            container.appendChild(viewBtn);
        }, 2000);
    }

    function downloadWorksheetPDF(questions, topic, ageGroup) {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    // Add title
    doc.setFont("helvetica", "bold");
    doc.setFontSize(16);
    doc.text(`Worksheet of ${topic} for ${ageGroup} Years`, 10, 10);

    doc.setFont("helvetica", "normal");
    doc.setFontSize(12);
    let yOffset = 30;

    questions.forEach((q, index) => {
        doc.text(`${index + 1}. ${q}`, 10, yOffset);
        yOffset += 10;
        doc.line(10, yOffset, 200, yOffset);
        yOffset += 10;
        doc.line(10, yOffset, 200, yOffset);
        yOffset += 15;
    });

    const pdfBlob = doc.output("blob");

    // Convert PDF to Base64
    const reader = new FileReader();
    reader.readAsDataURL(pdfBlob);
    reader.onloadend = function () {
        const pdfBase64 = reader.result;

        // Log download activity
        fetch("/log_activity", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                user: localStorage.getItem("currentUser") || "Guest",
                action: "Downloaded Worksheet",
                resource_type: "Worksheet",
                resource_name: `${topic} (${ageGroup} Years)`,
                date: new Date().toLocaleString(),
                source: "AI Generated",
                pdf: pdfBase64
            })
        }).then(() => {
            renderPdfActivityLog(); // Update the table
        });

        doc.save(`Worksheet_${topic}_${ageGroup}.pdf`);
        logActivity("Downloaded Worksheet", "Worksheet", `${topic} (${ageGroup} Years)`);
    };
}


    // Function to toggle between displaying and hiding the worksheet PDF inline with scrollable overflow
    function toggleViewWorksheetPDF(questions, topic, ageGroup) {
        const container = document.getElementById("pdf-viewer-container");
        const canvas = document.getElementById("pdf-canvas");
        const ctx = canvas.getContext("2d");

        // Check if the container is already displayed
        if (container.style.display === "block") {
            container.style.display = "none"; // Hide the PDF container if it's already visible
            return;
        }

        // Show the PDF viewer container if it's hidden
        container.style.display = "block";

        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();

        // Add title
        doc.setFont("helvetica", "bold");
        doc.setFontSize(16);
        doc.text(`Worksheet of ${topic} for ${ageGroup} Years`, 10, 10);

        doc.setFont("helvetica", "normal");
        doc.setFontSize(12);

        let yOffset = 30;

        questions.forEach((q, index) => {
            doc.text(`${index + 1}. ${q}`, 10, yOffset);
            yOffset += 10;

            // Add space for solving (two lines)
            doc.line(10, yOffset, 200, yOffset);
            yOffset += 10;
            doc.line(10, yOffset, 200, yOffset);
            yOffset += 15;
        });

        // Render the PDF on a canvas using PDF.js
        const pdfData = doc.output("arraybuffer"); // Get PDF data in arraybuffer format

        const loadingTask = pdfjsLib.getDocument({ data: pdfData });
        loadingTask.promise.then(function (pdf) {
            pdf.getPage(1).then(function (page) {
                const viewport = page.getViewport({ scale: 1.5 });
                canvas.height = viewport.height;
                canvas.width = viewport.width;

                const renderContext = {
                    canvasContext: ctx,
                    viewport: viewport
                };
                page.render(renderContext);
            });
        }).catch(function (error) {
            console.error("Error rendering PDF:", error);
            alert("Failed to render PDF.");
        });
    }







    </script>

<script>
    function savePdfData(action, topic, ageGroup, pdfBlob, sourceType = "AI Generated") {
    const user = localStorage.getItem("currentUser") || "Guest"; 

    const reader = new FileReader();
    reader.readAsDataURL(pdfBlob);
    reader.onloadend = function () {
        const pdfBase64 = reader.result;

        const newEntry = {
            user: user,
            action: action,
            resource_type: "Worksheet",
            resource_name: `${topic} (${ageGroup} Years)`,
            date: new Date().toLocaleString(),
            source: sourceType,
            pdf: pdfBase64
        };

        fetch("/log_activity", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(newEntry)
        });

        displayPdfInChatbot(pdfBase64);
    };
}



    function toggleViewWorksheetPDF(questions, topic, ageGroup) {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();

        doc.setFont("helvetica", "bold");
        doc.setFontSize(16);
        doc.text(`Worksheet of ${topic} for ${ageGroup} Years`, 10, 10);

        doc.setFont("helvetica", "normal");
        doc.setFontSize(12);
        let yOffset = 30;

        questions.forEach((q, index) => {
            doc.text(`${index + 1}. ${q}`, 10, yOffset);
            yOffset += 10;
            doc.line(10, yOffset, 200, yOffset);
            yOffset += 10;
            doc.line(10, yOffset, 200, yOffset);
            yOffset += 15;
        });

        const pdfBlob = doc.output("blob");
        savePdfData("Viewed Worksheet", topic, ageGroup, pdfBlob);
    }

    function displayPdfInChatbot(pdfBase64) {
        const pdfViewer = document.getElementById("pdf-viewer-container");
        pdfViewer.innerHTML = `<iframe src="${pdfBase64}" width="100%" height="500px"></iframe>`;
        pdfViewer.style.display = "block";
    }

    
</script>








<script>
    let currentPage = 1;
    const itemsPerPage = 10;

    function getPdfActivityLog() {
        const log = JSON.parse(localStorage.getItem("pdfActivityLog")) || [];
        return log.reverse(); // Show latest first
    }

    async function renderPdfActivityLog() {
            try {
                const response = await fetch('/get_activity_logs');
                const logs = await response.json();
                const pdfLogBody = document.getElementById('pdf-log-body');
                pdfLogBody.innerHTML = '';
                logs.forEach(log => {
                    const logRow = document.createElement('tr');
                    logRow.innerHTML = `
                        <td>${log.user}</td>
                        <td>${log.action}</td>
                        <td>${log.resource_type} - ${log.resource_name}</td>
                        <td>${log.date}</td>
                        <td>${log.source}</td>
                        <td>
                            <button class="btn btn-primary btn-sm" onclick="viewPdf('${log.pdf}')">View</button>
                            <a href="${log.pdf}" download="${log.resource_name.replace(/\s+/g, '_')}.pdf" class="btn btn-success btn-sm">Download</a>
                        </td>
                    `;
                    pdfLogBody.appendChild(logRow);
                });
            } catch (error) {
                console.error("Error loading activity logs:", error);
            }
        }





    function renderPaginationControls(totalPages) {
        const paginationContainer = document.getElementById('pagination-controls');
        paginationContainer.innerHTML = '';

        if (totalPages > 1) {
            if (currentPage > 1) {
                paginationContainer.innerHTML += `<button class="btn btn-sm btn-outline-secondary" onclick="changePage(-1)">Prev</button>`;
            }
            paginationContainer.innerHTML += `<span class="mx-2">Page ${currentPage} of ${totalPages}</span>`;
            if (currentPage < totalPages) {
                paginationContainer.innerHTML += `<button class="btn btn-sm btn-outline-secondary" onclick="changePage(1)">Next</button>`;
            }
        }
    }

    function changePage(direction) {
        currentPage += direction;
        renderPdfActivityLog();
    }

    function viewPdf(pdfBase64) {
        const iframe = document.getElementById('pdfIframe');
        iframe.src = pdfBase64;

        const myModal = new bootstrap.Modal(document.getElementById('pdfModal'));
        myModal.show();
    }

    document.addEventListener("DOMContentLoaded", renderPdfActivityLog);
</script>


<script>

   // Function to log user activity when a "Generate Worksheet" button is clicked 
async function generateWorksheet() {
    // Retrieve selected topic and age group
    let topic = selectedTopic || document.querySelector("#topic-buttons .active")?.dataset.value;
    let ageGroup = selectedAgeGroup || document.querySelector("#age-buttons .active")?.dataset.value;

    if (!topic || !ageGroup) {
        alert("Please select a topic and an age group.");
        return;
    }
    logActivity("Generated Worksheet", "Worksheet", `${topic} (${ageGroup} Years)`);
    // Clear previous worksheet and PDF viewer
    clearPreviousWorksheet();

    // Show loading message
    const container = document.getElementById("worksheet-display");
    container.innerHTML = `
        <div id="loading-message" class="text-center mt-3">
            <h4>Generating content...</h4>
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
        </div>
    `;

    // Simulate loading time
    await new Promise(resolve => setTimeout(resolve, 3000));  

    // AI Prompt for generating worksheet questions
    const prompt = `Generate a JSON object containing an array called "data" with 5 elements. 
Each element should be a string-based question for a worksheet on the topic '${topic}' for 
${ageGroup}-year-old children. Ensure the response is valid JSON with no extra text.`;

    try {
        const worksheetData = await fetchAIResponse(prompt);

        if (!worksheetData) {
            throw new Error("AI response is empty.");
        }

        displayWorksheet(worksheetData, topic, ageGroup);
    } catch (error) {
        console.error("‚ùå Error fetching AI response:", error);
        alert("Failed to generate worksheet. Please try again.");

        // Remove loading message on error
        container.innerHTML = "";
    }
}

// Function to clear previous worksheet and PDF viewer
function clearPreviousWorksheet() {
    document.getElementById('worksheet-display').innerHTML = ""; // Clear worksheet display
    document.getElementById('pdf-viewer-container').style.display = "none"; // Hide PDF viewer
}


</script>


<!-- Include Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>


<script>
    document.addEventListener("DOMContentLoaded", function () {
        loadReportData();
    });

    // Function to load report data
    function loadReportData() {
        const downloads = {
            worksheets: [5, 10, 8, 12, 7, 15], // Example: Downloads per month
            flashcards: [10, 12, 15, 18, 22, 28], 
            months: ["Jan", "Feb", "Mar", "Apr", "May", "Jun"]
        };

        const interactions = {
            messages: [20, 35, 30, 40, 38, 45],
            forumPosts: [5, 8, 6, 10, 9, 12],
            qaQuestions: [3, 5, 4, 7, 6, 8],
            months: ["Jan", "Feb", "Mar", "Apr", "May", "Jun"]
        };

        // Render time-series charts
        renderDownloadChart(downloads);
        renderEngagementChart(interactions);
    }

    // Function to render downloads timeline chart
    function renderDownloadChart(data) {
        const ctx = document.getElementById("resource-downloads-chart").getContext("2d");
        new Chart(ctx, {
            type: "line",
            data: {
                labels: data.months, 
                datasets: [
                    {
                        label: "Worksheets",
                        data: data.worksheets,
                        borderColor: "#007BFF",
                        backgroundColor: "rgba(0, 123, 255, 0.2)",
                        fill: true
                    },
                    {
                        label: "Flashcards",
                        data: data.flashcards,
                        borderColor: "#28A745",
                        backgroundColor: "rgba(40, 167, 69, 0.2)",
                        fill: true
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: { title: { display: true, text: "Month" } },
                    y: { beginAtZero: true, title: { display: true, text: "Downloads" } }
                }
            }
        });
    }

    // Function to render engagement timeline chart
    function renderEngagementChart(data) {
        const ctx = document.getElementById("engagement-chart").getContext("2d");
        new Chart(ctx, {
            type: "line",
            data: {
                labels: data.months, 
                datasets: [
                    {
                        label: "Community Chat",
                        data: data.messages,
                        borderColor: "#FFC107",
                        backgroundColor: "rgba(255, 193, 7, 0.2)",
                        fill: true
                    },
                    {
                        label: "Forum Posts",
                        data: data.forumPosts,
                        borderColor: "#17A2B8",
                        backgroundColor: "rgba(23, 162, 184, 0.2)",
                        fill: true
                    },
                    {
                        label: "Q&A",
                        data: data.qaQuestions,
                        borderColor: "#DC3545",
                        backgroundColor: "rgba(220, 53, 69, 0.2)",
                        fill: true
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: { title: { display: true, text: "Month" } },
                    y: { beginAtZero: true, title: { display: true, text: "Engagement" } }
                }
            }
        });
    }
</script>








<script>


// Toggle Community Submenu
function toggleCommunity() {
    let container = document.getElementById("community-container");
    container.style.display = container.style.display === "none" ? "block" : "none";
}

// Load Content Pages (Same as Sidebar Links)
function loadContent(pageId) {
    let allPages = document.querySelectorAll('.content-page');

    // Hide all pages
    allPages.forEach(page => page.style.display = "none");

    // Show the selected page
    document.getElementById(pageId).style.display = "block";
}


</script>




<script>
    // Pre-defined PDF URLs for each topic and age group combination
    const pdfUrls = {
        "Synthetic Phonics": {
            "2-4": "/static/images/Synpdf.pdf",
            "4-5": "/static/images/Jolly_Phonics_2-4_Years.pdf",
            "5-10": "path/to/synthetic_phonics_5_10.pdf"
        },
        "Systematic Synthetic Approach": {
            "2-4": "/static/images/Blending_Segmenting_5-7_Years.pdf",
            "4-5": "path/to/systematic_synthetic_4_5.pdf",
            "5-10": "path/to/systematic_synthetic_5_10.pdf"
        },
        "Fundamental Phonics Rules": {
            "2-4": "path/to/fundamental_phonics_2_4.pdf",
            "4-5": "path/to/fundamental_phonics_4_5.pdf",
            "5-10": "path/to/fundamental_phonics_5_10.pdf"
        },
        // Add more topics with their respective PDFs
    };

    // Initialize variables to store selected topic and age group
    let selectedTopic = '';
    let selectedAgeGroup = '';

// Event listener for topic button selection
document.getElementById('topic-buttons').addEventListener('click', function(event) {
    if (event.target.tagName === 'BUTTON') {
        // Deselect other buttons
        Array.from(event.currentTarget.children).forEach(button => button.classList.remove('active'));
        // Mark this button as selected
        event.target.classList.add('active');
        
        // Clear previous worksheet and PDF viewer
        clearPreviousWorksheet();

        selectedTopic = event.target.getAttribute('data-value');
    }
});

// Event listener for age group button selection
document.getElementById('age-buttons').addEventListener('click', function(event) {
    if (event.target.tagName === 'BUTTON') {
        // Deselect other buttons
        Array.from(event.currentTarget.children).forEach(button => button.classList.remove('active'));
        // Mark this button as selected
        event.target.classList.add('active');
        
        // Clear previous worksheet and PDF viewer
        clearPreviousWorksheet();

        selectedAgeGroup = event.target.getAttribute('data-value');
    }
});


    // Event listener to show more topics
    document.getElementById('show-more-topics').addEventListener('click', function() {
        const extraTopics = document.getElementById('extra-topics');
        extraTopics.style.display = extraTopics.style.display === 'none' ? 'block' : 'none';
        this.textContent = extraTopics.style.display === 'block' ? '- Less' : '+ More';
    });

    // Event listener to show more age groups
    document.getElementById('show-more-age-groups').addEventListener('click', function() {
        const extraAgeGroups = document.getElementById('extra-age-groups');
        extraAgeGroups.style.display = extraAgeGroups.style.display === 'none' ? 'block' : 'none';
        this.textContent = extraAgeGroups.style.display === 'block' ? '- Less' : '+ More';
    });

    // Event listener for creating the worksheet
    document.getElementById('create-worksheet').addEventListener('click', function() {
        if (selectedTopic && selectedAgeGroup) {
            // Get the PDF URL based on selected topic and age group
            const pdfUrl = pdfUrls[selectedTopic] ? pdfUrls[selectedTopic][selectedAgeGroup] : '';

            if (pdfUrl) {
                // Display the PDF in an iframe
                const iframe = `<iframe src="${pdfUrl}" width="100%" height="500px"></iframe>`;
                document.getElementById('worksheet-display').innerHTML = iframe;

                // Enable the download PDF button
                document.getElementById('download-pdf').style.display = 'block';
                
                // Store the PDF URL for download button
                document.getElementById('download-pdf').onclick = function() {
                    window.location.href = pdfUrl; // Download the PDF
                };
            } else {
                alert("PDF not available for this topic and age group.");
            }
        } else {
            alert("Please select both a topic and an age group.");
        }
    });
</script>



<!-- JavaScript (for flashcard creation and flipping functionality) -->
<script>
    function showLoadingPopup(message) {
        document.getElementById("loading-message").innerText = message;
        document.getElementById("loading-popup").style.display = "flex";
    }
    
    function hideLoadingPopup() {
        document.getElementById("loading-popup").style.display = "none";
    }
    
    async function generateFlashcards() {
    let topic = document.getElementById("topic-dropdown1").value;
    let ageGroup = document.getElementById("age-dropdown1").value;

    if (!topic || !ageGroup) {
        alert("Please select a topic and an age group.");
        return;
    }

    showLoadingPopup("Generating Flashcards...");
    logActivity("Generated Flashcards", "Flashcard", `${topic} (${ageGroup} Years)`);

    let prompt = `Generate a JSON object with an array called "flashcards". Each element should have 
    a "question" and an "answer" for flashcards on the topic '${topic}' for ${ageGroup}-year-old children.`;

    let aiResponse = await fetchAIResponse(prompt);

    hideLoadingPopup();

    if (!aiResponse || !aiResponse.flashcards) {
        alert("Failed to generate flashcards.");
        return;
    }

    displayFlashcards(aiResponse.flashcards, topic, ageGroup);
}

function displayFlashcards(flashcards, topic, ageGroup) {
    let container = document.getElementById("flashcards-display");
    container.innerHTML = "";

    flashcards.forEach(card => {
        let flashcardDiv = document.createElement("div");
        flashcardDiv.classList.add("flashcard");
        flashcardDiv.innerHTML = `
            <div class="flashcard-inner">
                <div class="flashcard-front">${card.question}</div>
                <div class="flashcard-back">${card.answer}</div>
            </div>
        `;

        flashcardDiv.addEventListener("click", () => {
            flashcardDiv.classList.toggle("flip");
        });

        container.appendChild(flashcardDiv);
    });
    let downloadBtn = document.getElementById("downloadFlashcardBtn");
downloadBtn.style.display = "block";
downloadBtn.onclick = () => downloadFlashcardPDF(flashcards, topic, ageGroup);

    // Save and auto-download the flashcard PDF
    saveFlashcardData("Generated Flashcard", topic, ageGroup, flashcards);
}

function saveFlashcardData(action, topic, ageGroup, flashcards) {
    const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            doc.text(`Flashcards: ${topic} (${ageGroup} Years)`, 10, 10);
            let yOffset = 20;
            flashcards.forEach((card, index) => {
                doc.text(`${index + 1}. ${card.question}`, 10, yOffset);
                yOffset += 15;
                doc.text(`Answer: ${card.answer}`, 10, yOffset);
                yOffset += 20; // Increased space between question and answer
            });
            const pdfBlob = doc.output("blob");
            const reader = new FileReader();
            reader.readAsDataURL(pdfBlob);
            reader.onloadend = function () {
                const pdfBase64 = reader.result;
                const logEntry = {
                    user: "Guest",
                    action: action,
                    resource_type: "Flashcard",
                    resource_name: `${topic} (${ageGroup} Years)`,
                    date: new Date().toLocaleString(),
                    source: "AI Generated",
                    pdf: pdfBase64
                };
                fetch("/log_activity", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(logEntry)
                }).then(response => response.json()).then(() => {
                    renderPdfActivityLog();
                }).catch(error => console.error("Error saving flashcard log:", error));
            };
        }


function downloadFlashcards() {
    let topic = document.getElementById("topic-dropdown1").value;
    let ageGroup = document.getElementById("age-dropdown1").value;

    logActivity("Downloaded Flashcards", "Flashcard", `${topic} (${ageGroup} Years)`);
}

document.getElementById("downloadFlashcardBtn").setAttribute("data-pdf-url", pdfBase64);





    
    
    
    function downloadFlashcardPDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
    
        doc.text("Generated Flashcards", 10, 10);
    
        let yOffset = 20;
        document.querySelectorAll(".flashcard-front").forEach((front, index) => {
            let answer = document.querySelectorAll(".flashcard-back")[index].innerText;
            doc.text(`${index + 1}. ${front.innerText} - ${answer}`, 10, yOffset);
            yOffset += 10;
        });
    
        doc.save("flashcards.pdf");
    }
    
    
    document.getElementById('start-flashcards').addEventListener('click', function() {
        const topic = document.getElementById('topic-dropdown1').value;
        const ageGroup = document.getElementById('age-dropdown1').value;
        
        if (!topic || !ageGroup) {
            alert("Please select a topic and an age group.");
            return;
        }
    
        // Sample flashcards data for each topic and age group
        const flashcards = getFlashcardsData(topic, ageGroup);
    
        // Clear the container before adding new flashcards
        const flashcardContainer = document.getElementById('flashcard-container');
        flashcardContainer.innerHTML = '';
    
        // Show flashcards dynamically
        flashcards.forEach(card => {
            const flashcard = createFlashcard(card.question, card.answer);
            flashcardContainer.appendChild(flashcard);
        });


        
    });
    
    function getFlashcardsData(topic, ageGroup) {
        // Sample flashcards data based on topic and age group
        const flashcards = {
            'Synthetic Phonics': {
                '2-4': [
                    { question: "What sound does 'a' make?", answer: "Ah" },
                    { question: "What sound does 'b' make?", answer: "Buh" },
                ],
                '4-5': [
                    { question: "What sound does 'c' make?", answer: "Cuh" },
                    { question: "What sound does 'd' make?", answer: "Duh" },
                ],
                '5-10': [
                    { question: "What is the sound for 'ch'?", answer: "Chuh" },
                    { question: "What is the sound for 'sh'?", answer: "Shh" },
                ]
            },
            'Systematic Synthetic Approach': {
                '2-4': [
                    { question: "What is the first sound of 'cat'?", answer: "Cuh" },
                    { question: "What is the first sound of 'dog'?", answer: "Duh" },
                ],
                '4-5': [
                    { question: "What is the first sound of 'mat'?", answer: "Mmm" },
                    { question: "What is the first sound of 'bat'?", answer: "Buh" },
                ],
                '5-10': [
                    { question: "What is the sound for 'ph'?", answer: "Fuh" },
                    { question: "What is the sound for 'ou'?", answer: "Ow" },
                ]
            },
            'Fundamental Phonics Rules': {
                '2-4': [
                    { question: "What is the sound for 's'?", answer: "Sss" },
                    { question: "What is the sound for 't'?", answer: "Tuh" },
                ],
                '4-5': [
                    { question: "What is the sound for 'm'?", answer: "Mmm" },
                    { question: "What is the sound for 'n'?", answer: "Nuh" },
                ],
                '5-10': [
                    { question: "What is the sound for 'ar'?", answer: "Arh" },
                    { question: "What is the sound for 'er'?", answer: "Er" },
                ]
            }
        };
    
        return flashcards[topic][ageGroup] || [];
    }
    
    function createFlashcard(question, answer) {
        const flashcard = document.createElement('div');
        flashcard.classList.add('flashcard');
        flashcard.innerHTML = `
            <div class="flashcard-inner">
                <div class="flashcard-front">
                    <div>${question}</div>
                </div>
                <div class="flashcard-back">
                    <div>${answer}</div>
                </div>
            </div>
        `;
        
        flashcard.addEventListener('click', function() {
            flashcard.classList.toggle('flipped');
        });
    
        return flashcard;
    }
    </script>

<script>

    //logout
    function logoutUser() {
                fetch('/logout', { method: 'GET' })  // Calls Flask logout route
                .then(response => {
                    window.location.href = "/";  // Redirect to homepage after logout
                });
            }
    
    
            // Sample events data
            const events = [
                {
                    date: '2025-02-10',
                    title: 'Event 1',
                    dateTime: '2025-02-10 10:00 AM',
                    link: 'https://example.com/event1',
                    payment: '$20',
                    type: 'danger'
                },
                {
                    date: '2025-02-12',
                    title: 'Event 2',
                    dateTime: '2025-02-12 3:00 PM',
                    link: 'https://example.com/event2',
                    payment: 'Free',
                    type: 'success'
                },
                {
                    date: '2025-02-15',
                    title: 'Event 3',
                    dateTime: '2025-02-15 5:00 PM',
                    link: 'https://example.com/event3',
                    payment: '$15',
                    type: 'primary'
                }
            ];
    
            let currentMonth = new Date().getMonth();  // Current month (0-11)
            let currentYear = new Date().getFullYear(); // Current year (e.g. 2025)
    
            // Month names array
            const monthNames = [
                'January', 'February', 'March', 'April', 'May', 'June',
                'July', 'August', 'September', 'October', 'November', 'December'
            ];
    
            // Function to generate the calendar for the given month and year
            function generateCalendar() {
                const calendarGrid = document.getElementById('calendar-grid');
                const monthYearDisplay = document.getElementById('calendar-month-year');
    
                // Update the displayed month and year
                monthYearDisplay.textContent = `${monthNames[currentMonth]} ${currentYear}`;
    
                const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate(); // Get number of days in the month
                const firstDayOfMonth = new Date(currentYear, currentMonth, 1).getDay(); // Get day of the week for the 1st of the month
    
                // Clear the calendar grid
                calendarGrid.innerHTML = '';
    
                // Add empty cells before the first day of the month
                for (let i = 0; i < firstDayOfMonth; i++) {
                    calendarGrid.innerHTML += `<div class="calendar-day"></div>`;
                }
    
                // Add the days of the month
                for (let day = 1; day <= daysInMonth; day++) {
                    const dateString = `${currentYear}-${(currentMonth + 1).toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
                    const event = events.find(event => event.date === dateString);
    
                    // Highlight event days and add event types (danger, success, primary)
                    let eventClass = '';
                    if (event) {
                        eventClass = event.type; // Assign class based on event type
                        calendarGrid.innerHTML += `<div class="calendar-day ${eventClass}" onclick="showEventDetails('${event.title}')">
                            ${day}
                        </div>`;
                    } else {
                        calendarGrid.innerHTML += `<div class="calendar-day">${day}</div>`;
                    }
                }
            }
    
            // Function to navigate between months
            function changeMonth(direction) {
                currentMonth += direction;
                if (currentMonth > 11) {
                    currentMonth = 0;
                    currentYear++;
                } else if (currentMonth < 0) {
                    currentMonth = 11;
                    currentYear--;
                }
                generateCalendar();  // Regenerate the calendar after changing the month
            }
    
            // Function to show event details in a pop-up
            function showEventDetails(eventTitle) {
                const event = events.find(e => e.title === eventTitle);
                if (event) {
                    document.getElementById('event-title').innerText = event.title;
                    document.getElementById('event-date-time').innerText = event.dateTime;
                    document.getElementById('event-link').href = event.link;
                    document.getElementById('event-payment').innerText = event.payment;
                    document.getElementById('event-popup').style.display = 'flex';
                }
            }
    
            // Close the event pop-up
            function closePopup() {
                document.getElementById('event-popup').style.display = 'none';
            }
    
            // Initialize the calendar
            generateCalendar();




            
        </script>

<script>function logActivity(action, resourceType, resourceName, sourceType = "AI Generated") {
    const logData = {
        action: action,
        resource_type: resourceType, // 'Worksheet' or 'Flashcard'
        resource_name: resourceName,
        source: sourceType
    };

    fetch("/log_activity", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(logData)
    });
}
</script>


</body>
</html>

